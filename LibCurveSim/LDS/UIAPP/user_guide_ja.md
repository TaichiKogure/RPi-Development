# リチウムイオン電池シミュレーション・解析ツール ユーザーガイド

## 目次

1. [はじめに](#はじめに)
2. [インストール方法](#インストール方法)
3. [アプリケーションの起動](#アプリケーションの起動)
4. [シミュレーションタブ](#シミュレーションタブ)
5. [解析タブ](#解析タブ)
6. [機械学習タブ](#機械学習タブ)
7. [データエクスポートタブ](#データエクスポートタブ)
8. [トラブルシューティング](#トラブルシューティング)
9. [よくある質問](#よくある質問)

## はじめに

リチウムイオン電池シミュレーション・解析ツールは、リチウムイオン電池の充放電サイクルと経時劣化をシミュレーションし、そのデータを解析するための総合的なツールです。このアプリケーションでは、以下の機能を提供します：

- リチウムイオン電池の充放電サイクルのシミュレーション
- 容量劣化と内部抵抗の増加を考慮したモデル
- dQ/dV（微分容量）曲線の計算と可視化
- dQ/dV曲線のピーク検出と解析
- 機械学習による劣化パターンの分析と予測
- 各種データのエクスポート

このツールは、電池研究者、エンジニア、学生など、リチウムイオン電池の特性と劣化メカニズムに興味を持つ方々を対象としています。

## インストール方法

### 必要条件

- Python 3.6以上
- 以下のPythonパッケージ：
  - numpy
  - matplotlib
  - scipy
  - pandas
  - scikit-learn
  - tensorflow（機械学習機能を使用する場合）

### インストール手順

1. Pythonがインストールされていない場合は、[Python公式サイト](https://www.python.org/downloads/)からダウンロードしてインストールしてください。

2. 必要なパッケージをインストールします：

```bash
pip install numpy matplotlib scipy pandas scikit-learn
pip install tensorflow  # 機械学習機能を使用する場合
```

3. アプリケーションのファイルをダウンロードまたはクローンします。

## アプリケーションの起動

1. コマンドラインで、アプリケーションのディレクトリに移動します：

```bash
cd path/to/LibCurveSim/LDS/UIAPP
```

2. アプリケーションを起動します：

```bash
python main_app.py
```

3. アプリケーションが起動し、メインウィンドウが表示されます。

## シミュレーションタブ

シミュレーションタブでは、リチウムイオン電池の充放電サイクルと経時劣化をシミュレーションできます。

### パラメータ設定

#### 電池の基本パラメータ

- **初期容量 (Ah)**: 電池の初期容量をアンペア時で指定します。
- **C-レート**: 充放電の速度を指定します。1Cは1時間で完全に充電または放電することを意味します。
- **初期内部抵抗 (Ω)**: 電池の初期内部抵抗をオームで指定します。

#### 劣化モデルのパラメータ

- **容量劣化パラメータA**: 容量劣化の最大値を制御するパラメータです。
- **容量劣化パラメータB**: 容量劣化の速度を制御するパラメータです。
- **抵抗増加パラメータC**: 内部抵抗の増加率を制御するパラメータです。
- **抵抗増加パラメータD**: 内部抵抗の増加の非線形性を制御するパラメータです。

#### シミュレーションのパラメータ

- **サイクル数**: シミュレーションするサイクル数を指定します。
- **時間ステップ (秒)**: シミュレーションの時間ステップを秒単位で指定します。
- **表示するサイクル**: グラフに表示するサイクルを選択します。

### シミュレーションの実行

1. パラメータを設定します。
2. 「シミュレーション実行」ボタンをクリックします。
3. シミュレーションが実行され、結果がグラフに表示されます。

### グラフの操作

- **グラフタイプ**: 充電曲線、放電曲線、容量維持率のいずれかを選択できます。
- **スムージング**: グラフのスムージングレベルを調整できます。
- **ズーム**: マウスのスクロールホイールでズームイン/アウトできます。
- **パン**: マウスの左ボタンを押しながらドラッグしてグラフを移動できます。
- **リセット**: グラフの右下にあるリセットボタンをクリックすると、元の表示に戻ります。

### 結果の保存

- **CSVに保存**: シミュレーション結果をCSVファイルに保存できます。
- **グラフを保存**: 現在表示されているグラフを画像ファイルに保存できます。

## 解析タブ

解析タブでは、シミュレーションデータまたは外部データを読み込み、dQ/dV曲線の計算とピーク検出を行うことができます。

### データの読み込み

- **シミュレーションデータを使用**: シミュレーションタブで生成したデータを使用します。
- **CSVファイルを読み込み**: 外部のCSVファイルを読み込みます。

### dQ/dV曲線の計算

1. データを読み込みます。
2. スムージングパラメータを設定します。
3. 「dQ/dV計算」ボタンをクリックします。
4. dQ/dV曲線が計算され、グラフに表示されます。

### ピーク検出

1. dQ/dV曲線を計算します。
2. ピーク検出パラメータを設定します：
   - **顕著さ (prominence)**: ピークの顕著さの最小値を指定します。
   - **幅 (width)**: ピークの幅の最小値を指定します。
   - **高さ (height)**: ピークの高さの最小値を指定します。
   - **距離 (distance)**: ピーク間の最小距離を指定します。
   - **電圧範囲**: ピーク検出を行う電圧範囲を指定します。
3. 「ピーク検出」ボタンをクリックします。
4. 検出されたピークがグラフに表示されます。

### 結果の可視化

- **サイクル選択**: 表示するサイクルを選択できます。
- **グラフタイプ**: dQ/dV曲線、容量-電圧曲線、ピーク検出結果のいずれかを選択できます。
- **グラフの操作**: シミュレーションタブと同様の操作が可能です。

### 結果の保存

- **dQ/dVデータを保存**: 計算されたdQ/dVデータをCSVファイルに保存できます。
- **ピークデータを保存**: 検出されたピークのデータをCSVファイルに保存できます。
- **グラフを保存**: 現在表示されているグラフを画像ファイルに保存できます。

## 機械学習タブ

機械学習タブでは、dQ/dV曲線データを用いて機械学習モデルを構築し、電池の劣化パターンを分析・予測することができます。

### データの準備

- **dQ/dVデータを使用**: 解析タブで計算したdQ/dVデータを使用します。
- **容量維持率データを使用**: シミュレーションタブで生成した容量維持率データを使用します。

### モデルの選択

以下の機械学習モデルから選択できます：

- **主成分分析 (PCA)**: dQ/dV曲線の主要な変動パターンを抽出します。
- **ランダムフォレスト**: dQ/dV曲線から容量維持率を予測します。
- **クラスタリング**: 類似したdQ/dV曲線をグループ化します。
- **ニューラルネットワーク**: 深層学習を用いて容量維持率を予測します。
- **サポートベクター回帰 (SVR)**: 非線形回帰を用いて容量維持率を予測します。

### モデルのパラメータ設定

各モデルに応じたパラメータを設定できます：

#### 主成分分析 (PCA)
- **主成分数**: 抽出する主成分の数を指定します。

#### ランダムフォレスト
- **木の数**: ランダムフォレストの木の数を指定します。
- **最大深さ**: 各木の最大深さを指定します。
- **テストデータ比率**: テストデータの割合を指定します。

#### クラスタリング
- **クラスタ数**: クラスタの数を指定します。
- **アルゴリズム**: K-meansまたはHierarchicalを選択できます。

#### ニューラルネットワーク
- **隠れ層のユニット数**: 各隠れ層のニューロン数を指定します。
- **ドロップアウト率**: ドロップアウトの確率を指定します。
- **エポック数**: 学習の繰り返し回数を指定します。
- **バッチサイズ**: 一度に処理するサンプル数を指定します。
- **テストデータ比率**: テストデータの割合を指定します。

#### サポートベクター回帰 (SVR)
- **カーネル**: 線形、多項式、RBFのいずれかを選択できます。
- **C**: 正則化パラメータを指定します。
- **テストデータ比率**: テストデータの割合を指定します。

### モデルの学習と評価

1. モデルとパラメータを選択します。
2. 「モデル学習」ボタンをクリックします。
3. モデルが学習され、結果がグラフに表示されます。

### 結果の可視化

モデルに応じて、以下のグラフが表示されます：

#### 主成分分析 (PCA)
- **主成分スコア**: 各サイクルの主成分スコアを表示します。
- **寄与率**: 各主成分の寄与率を表示します。
- **ローディング**: 各電圧ポイントの主成分への寄与度を表示します。

#### ランダムフォレスト、ニューラルネットワーク、SVR
- **予測値と実際の値の比較**: 予測された容量維持率と実際の値を比較します。
- **残差プロット**: 予測誤差を表示します。
- **特徴重要度**: 各電圧ポイントの重要度を表示します（ランダムフォレストのみ）。

#### クラスタリング
- **クラスタリング結果**: 各サイクルのクラスタを表示します。
- **クラスタの中心**: 各クラスタの中心となるdQ/dV曲線を表示します。

### 結果の保存

- **モデルを保存**: 学習したモデルを保存できます。
- **結果を保存**: 予測結果や評価指標をCSVファイルに保存できます。
- **グラフを保存**: 現在表示されているグラフを画像ファイルに保存できます。

## データエクスポートタブ

データエクスポートタブでは、シミュレーション、解析、機械学習の結果を様々な形式でエクスポートできます。

### データの選択

- **データタイプ**: シミュレーション、dQ/dV、ピーク、機械学習のいずれかを選択します。
- **サイクル**: 特定のサイクルまたはすべてのサイクルを選択できます。

### 出力形式の選択

- **形式**: CSV、JSON、Excelのいずれかを選択できます。
- **区切り文字**: CSV形式の場合、区切り文字を選択できます。

### オプション

- **ヘッダーを含める**: 出力にヘッダー行を含めるかどうかを選択できます。
- **インデックスを含める**: 出力に行インデックスを含めるかどうかを選択できます。

### エクスポート設定

- **出力先**: エクスポートファイルの保存先を指定します。
- **ファイル名**: エクスポートファイルの名前を指定します。
- **タイムスタンプ**: ファイル名にタイムスタンプを追加するかどうかを選択できます。

### プレビュー

選択したデータと形式のプレビューが表示されます。

### エクスポートの実行

1. データ、形式、オプション、エクスポート設定を選択します。
2. 「エクスポート」ボタンをクリックします。
3. データが指定した形式で保存されます。

## トラブルシューティング

### アプリケーションが起動しない

- Pythonが正しくインストールされているか確認してください。
- 必要なパッケージがすべてインストールされているか確認してください。
- コマンドラインから直接起動して、エラーメッセージを確認してください。

### シミュレーションが実行できない

- パラメータが適切な範囲内にあるか確認してください。
- メモリ不足の場合は、サイクル数や時間ステップを調整してください。

### dQ/dV曲線の計算に失敗する

- データが適切な形式であるか確認してください。
- スムージングパラメータを調整してみてください。

### 機械学習モデルの学習に失敗する

- データが十分にあるか確認してください。
- パラメータを調整してみてください。
- メモリ不足の場合は、モデルの複雑さを下げてみてください。

### グラフが表示されない

- データが正しく読み込まれているか確認してください。
- グラフの表示範囲を調整してみてください。

## よくある質問

### Q: どのようなデータ形式がサポートされていますか？

A: 現在、CSVファイル形式がサポートされています。CSVファイルは以下の列を含む必要があります：
- サイクル番号
- 容量（Ah）
- 電圧（V）

### Q: 大量のサイクルデータを処理できますか？

A: はい、ただしコンピュータのメモリ制限に依存します。非常に大量のデータを処理する場合は、サイクル数を制限するか、時間ステップを大きくすることをお勧めします。

### Q: 実験データを使用できますか？

A: はい、適切な形式のCSVファイルであれば、実験データを読み込んで解析できます。

### Q: 機械学習モデルの精度を向上させるにはどうすればよいですか？

A: 以下の方法を試してみてください：
- より多くのデータを使用する
- モデルのパラメータを調整する
- 特徴量の前処理を改善する
- より複雑なモデルを使用する

### Q: 結果をレポートに含めるにはどうすればよいですか？

A: グラフを画像ファイルとして保存し、データをCSV、JSON、またはExcel形式でエクスポートして、レポートに含めることができます。

### Q: カスタムモデルを追加できますか？

A: 現在のバージョンでは、提供されているモデルのみが使用可能です。カスタムモデルを追加するには、ソースコードを修正する必要があります。