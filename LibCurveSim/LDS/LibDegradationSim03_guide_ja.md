# LibDegradationSim03.py 解説ガイド

## 概要
このプログラムはリチウムイオン電池の充放電サイクルと経時劣化をシミュレーションするためのツールです。電池の容量低下と内部抵抗の増加を考慮しながら、複数サイクルにわたる充電・放電曲線を生成します。

## 主要コンポーネント

### 1. OCV-SOC関係
- SOC（充電状態）とOCV（開回路電圧）の関係を定義
- 0%から100%までの11点のデータポイントを使用
- 線形補間で中間値を計算

### 2. 充電シミュレーション (simulate_charge)
- 定電流(CC)充電フェーズ：最大電圧に達するまで一定電流で充電
- 定電圧(CV)充電フェーズ：最大電圧を維持しながら電流を徐々に減少
- 終了条件：電流が初期値の5%以下になるか、SOCが100%に達する

### 3. 放電シミュレーション (simulate_discharge)
- 定電流放電：最小電圧に達するまで一定電流で放電
- 終了条件：端子電圧が最小値以下になるか、SOCが0%に達する

### 4. 劣化モデル
- 容量劣化モデル (capacity_after_cycle)：サイクル数に応じて容量が指数関数的に減少
  - 数式: Q = Q0 * (1 - A * (1 - exp(-B * n)))
  - Q0：初期容量、A：最大劣化率、B：劣化速度係数、n：サイクル数

- 抵抗増加モデル (resistance_after_cycle)：サイクル数に応じて内部抵抗が増加
  - 数式: R = R0 * (1 + C * (n^D))
  - R0：初期抵抗、C：抵抗増加係数、D：抵抗増加の指数、n：サイクル数

### 5. サイクルシミュレーション (run_all_cycles)
- 指定されたサイクル数分の充放電をシミュレーション
- 各サイクルで劣化した容量と抵抗値を計算
- 結果をリストとして返す

### 6. 結果の可視化 (plot_all_smoothed)
- 充電曲線と放電曲線を別々のグラフに表示
- UnivariateSplineを使用してデータを平滑化
- 各サイクルの曲線を重ねて表示し、劣化の進行を視覚化

## 主要パラメータ

| パラメータ | 説明 | デフォルト値 |
|------------|------|-------------|
| cap_ah (Q0) | 電池の初期容量 (Ah) | 3.0 |
| c_rate | 充放電のC-レート | 0.5 |
| resistance (R0) | 初期内部抵抗 (Ω) | 0.05 |
| A | 容量劣化の最大割合 | 0.1 |
| B | 容量劣化の速度係数 | 0.05 |
| C | 抵抗増加の係数 | 0.05 |
| D | 抵抗増加の指数 | 1.0 |
| v_max | 最大充電電圧 (V) | 4.1797 |
| v_min | 最小放電電圧 (V) | 3.0519 |
| end_current_ratio | CV充電終了の電流比率 | 0.05 |
| dt | シミュレーションの時間ステップ (秒) | 1.0 |
| num_cycles | シミュレーションするサイクル数 | 20 |
| smoothing_s | グラフの平滑化係数 | 0.05 |

## 使用方法
プログラムを実行すると、デフォルトで20サイクルの充放電シミュレーションが行われ、結果がグラフとして表示されます。パラメータを変更する場合は、コード内の関数呼び出し部分を編集してください。

```python
if __name__=='__main__':
    res = run_all_cycles(num_cycles=20, c_rate=0.5)
    plot_all_smoothed(res, smoothing_s=0.05)
```

## 応用例
- 異なる充放電レートの影響を調査
- 劣化パラメータを調整して様々な劣化モードをシミュレーション
- 電池設計の最適化のための性能予測