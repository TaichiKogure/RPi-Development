# LibDegradationSim03_i.py 解説ガイド

## 概要
LibDegradationSim03_i.py は、リチウムイオン電池の充放電サイクルと経時劣化をシミュレーションするための対話型ツールです。ユーザーが各種パラメータを入力することで、電池の容量低下と内部抵抗の増加を考慮した充放電曲線をカスタマイズして生成できます。

## 主な機能

### 1. 対話型パラメータ入力
- コマンドラインインターフェースを通じて、すべての重要なパラメータを対話的に設定可能
- 各パラメータにはデフォルト値が設定されており、Enterキーを押すだけで使用可能
- 入力値の検証機能により、無効な値や範囲外の値を防止

### 2. シミュレーション実行
- 入力されたパラメータに基づいて、指定されたサイクル数の充放電シミュレーションを実行
- 各サイクルごとに劣化した容量と内部抵抗を計算
- 充電曲線（CC-CV）と放電曲線を生成

### 3. 結果の可視化
- 充電曲線と放電曲線を別々のグラフに表示
- 各サイクルの曲線を重ねて表示し、劣化の進行を視覚化
- UnivariateSplineを使用してデータを平滑化

### 4. CSV出力機能
- シミュレーション結果をCSVファイルに保存するオプション
- サイクル概要（サイクル番号、容量、抵抗）を保存
- 各サイクルの詳細な充放電データを個別のファイルに保存
- タイムスタンプ付きのファイル名で上書きを防止

## 使用方法

1. プログラムを実行すると、対話モードが開始されます：
   ```
   python LibDegradationSim03_i.py
   ```

2. 以下のカテゴリのパラメータを順に入力します：
   - **電池の基本パラメータ**：初期容量、初期内部抵抗、最大充電電圧、最小放電電圧
   - **劣化モデルのパラメータ**：容量劣化の最大割合、劣化速度係数、抵抗増加係数、抵抗増加指数
   - **シミュレーションのパラメータ**：サイクル数、C-レート、CV充電終了の電流比率、時間ステップ、平滑化係数

3. シミュレーションが実行され、結果がグラフとして表示されます。

4. シミュレーション終了後、結果をCSVファイルに保存するかどうかを選択できます。

## パラメータ説明

| パラメータ | 説明 | デフォルト値 | 有効範囲 |
|------------|------|-------------|----------|
| 初期容量 (Ah) | 電池の初期容量 | 3.0 | > 0.1 |
| 初期内部抵抗 (Ω) | 電池の初期内部抵抗 | 0.05 | > 0.001 |
| 最大充電電圧 (V) | 充電終了電圧 | 4.1797 | 3.5 - 4.5 |
| 最小放電電圧 (V) | 放電終了電圧 | 3.0519 | 2.0 - 3.5 |
| 容量劣化の最大割合 (A) | 長期的な容量劣化の最大値（割合） | 0.1 | 0 - 1 |
| 容量劣化の速度係数 (B) | 容量劣化の進行速度 | 0.05 | > 0 |
| 抵抗増加の係数 (C) | 内部抵抗増加の大きさ | 0.05 | > 0 |
| 抵抗増加の指数 (D) | 内部抵抗増加の非線形性 | 1.0 | > 0 |
| サイクル数 | シミュレーションするサイクル数 | 20 | 1 - 1000 |
| C-レート | 充放電の電流レート（容量に対する倍率） | 0.5 | 0.05 - 10 |
| CV充電終了の電流比率 | CV充電を終了する電流の閾値（初期電流に対する比率） | 0.05 | 0.01 - 0.5 |
| 時間ステップ (秒) | シミュレーションの時間分解能 | 1.0 | > 0.1 |
| 平滑化係数 | グラフの曲線平滑化の度合い | 0.05 | ≥ 0 |

## CSV出力ファイル

プログラムは以下のCSVファイルを生成します：

1. **サイクル概要ファイル** (`{prefix}_summary_{timestamp}.csv`)
   - サイクル番号、容量、内部抵抗の概要データ

2. **充電データファイル** (`{prefix}_cycle{n}_charge_{timestamp}.csv`)
   - 各サイクルの充電過程における SOC、容量、電圧データ

3. **放電データファイル** (`{prefix}_cycle{n}_discharge_{timestamp}.csv`)
   - 各サイクルの放電過程における SOC、容量、電圧データ

## 応用例
- 異なる充放電レートの影響を調査
- 劣化パラメータを調整して様々な劣化モードをシミュレーション
- 電池設計の最適化のための性能予測
- 実験データとの比較による劣化モデルのキャリブレーション