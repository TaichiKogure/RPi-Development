# Raspberry Pi 5とPico 2Wスタンドアロン環境データ測定システム
# 操作マニュアル（BME680専用モード）
## バージョン2.0

## 概要

このドキュメントは、Raspberry Pi 5とPico 2Wスタンドアロン環境データ測定システムをBME680専用モード（バージョン2.0）で操作するための手順を提供します。このバージョンでは、システムはBME680センサーのみで動作するように変更され、CO2センサー（MH-Z19C）の機能は無効化されています。

## システムコンポーネント

1. **Raspberry Pi 5（P1）** - 中央ハブとして機能し、以下を行います：
   - P2-P6用のWiFiアクセスポイントとして機能
   - センサーノードから環境データを収集・保存
   - データ可視化用のWebインターフェースを提供
   - センサーノードとの接続品質を監視

2. **Raspberry Pi Pico 2W（P2-P6）** - センサーノードとして機能し、以下を行います：
   - BME680センサーを使用して環境データを収集
   - WiFi経由でデータをP1に送信
   - エラーや接続問題が発生した場合に自動再起動

3. **センサー**：
   - BME680 - 温度、湿度、大気圧、ガスパラメータを測定

## 主な機能

### P1（Raspberry Pi 5）の機能
- **デュアルWiFi機能**：
  - P2-P6用のWiFiアクセスポイント（AP）として機能
  - USBのWiFiドングル経由でインターネットに接続可能
  - USBドングルがない場合はAPモードを優先するように設定可能

- **データ管理**：
  - P2-P6から環境データを受信・保存
  - タイムスタンプ、温度、湿度、気圧、ガスパラメータ、絶対湿度をCSV形式で保存

- **可視化**：
  - P1のWiFiに接続したスマートフォン/デバイスからアクセス可能なWeb UI
  - 環境データの時系列グラフ
  - 現在の測定値のリアルタイム表示
  - ダウンロードデータのCSVエクスポート機能

- **接続モニタリング**：
  - P2-P6とのWiFi信号強度、ping時間、ノイズレベルを測定
  - 5秒ごとに更新（設定可能）
  - デバイスの物理的な配置の最適化に役立つ
  - Web UIとVNCインターフェースの両方で利用可能

### P2-P6（Raspberry Pi Pico 2W）の機能
- **センサー統合**：
  - BME680センサーの読み取りを30秒ごとに実行

- **データ送信**：
  - WiFi経由でP1への継続的なデータ送信
  - P2-P6デバイスの一意の識別

- **信頼性**：
  - センサーエラーやデータ収集の失敗時に自動再起動
  - 再起動後の自動WiFi再接続

## 操作手順

### システムの起動

1. **P1（Raspberry Pi 5）の電源を入れる**：
   - 電源をP1に接続
   - システムが起動するまで待つ（約1〜2分）
   - アクセスポイントが自動的に設定される

2. **P2-P6（Raspberry Pi Pico 2W）の電源を入れる**：
   - 各Pico 2Wデバイスに電源を接続
   - デバイスは自動的にP1のWiFiアクセスポイントに接続
   - LED表示で接続状態を確認できる

### Webインターフェースへのアクセス

1. **P1のWiFiネットワークに接続**：
   - スマートフォンやコンピュータで、WiFiネットワーク「RaspberryPi5_AP_Solo2」に接続
   - パスワード：「raspberry」

2. **Webインターフェースにアクセス**：
   - Webブラウザを開く
   - http://192.168.0.2 にアクセス
   - ダッシュボードに最新の環境データとグラフが表示される

### データの解釈

システムは以下の環境パラメータを収集・表示します：

1. **温度**（°C）：
   - BME680センサーで測定された周囲温度

2. **湿度**（%）：
   - BME680センサーで測定された相対湿度

3. **絶対湿度**（g/m³）：
   - 温度と相対湿度から計算

4. **気圧**（hPa）：
   - BME680センサーで測定された大気圧

5. **ガス抵抗**（Ω）：
   - BME680センサーで測定されたガス抵抗値（空気質の指標となる）

### ダッシュボードの使用

ダッシュボードはデータの可視化と分析のための複数の機能を提供します：

1. **リアルタイムデータ表示**：
   - 接続されているすべてのセンサーからの現在の測定値

2. **時系列グラフ**：
   - 履歴データの可視化
   - 調整可能な時間範囲（1日、7日など）
   - 特定のセンサーの表示/非表示オプション

3. **接続状態**：
   - 各センサーノードの信号強度と品質
   - ping時間とノイズレベル

4. **データエクスポート**：
   - さらなる分析のためにデータをCSVファイルとしてダウンロード

## トラブルシューティング

### P1（Raspberry Pi 5）の問題

1. **Webインターフェースにアクセスできない**：
   - 正しいWiFiネットワークに接続されていることを確認
   - P1の電源が入っていて、アクセスポイントがアクティブであることを確認
   - P1を再起動してみる

2. **データが表示されない**：
   - P2-P6デバイスの電源が入っていて接続されていることを確認
   - P1でデータ収集サービスが実行されていることを確認
   - ダッシュボードで接続状態を確認

### P2-P6（Raspberry Pi Pico 2W）の問題

1. **デバイスがWiFiに接続しない**：
   - デバイスの電源が入っていることを確認（LEDが点滅しているはず）
   - P1のアクセスポイントがアクティブであることを確認
   - デバイスをリセットしてみる

2. **センサー読み取りエラー**：
   - BME680センサーへの物理的な接続を確認
   - センサーが正しく初期化されていることを確認
   - デバイスをリセットしてみる

## メンテナンス

### 定期的なメンテナンスタスク

1. **システム状態の確認**：
   - すべてのデバイスの接続状態を定期的に監視
   - データが適切に収集・保存されていることを確認

2. **ソフトウェアの更新**：
   - 定期的にソフトウェアの更新を確認
   - 新しいリリースで提供される更新手順に従う

3. **データのバックアップ**：
   - 収集したデータを定期的にバックアップ
   - データはP1の以下のディレクトリにCSV形式で保存されています：
     - P2の場合：`/var/lib/raspap_solo/data/RawData_P2/`
     - P3の場合：`/var/lib/raspap_solo/data/RawData_P3/`
     - など

## 技術的注意事項

### BME680専用モード

バージョン2.0では、システムはBME680センサーのみで動作するように変更されています。CO2センサー（MH-Z19C）の機能はソフトウェアで無効化されています。この変更は以下のコンポーネントに影響します：

1. **P1のデータ収集**：
   - CSVファイルにはCO2データ列が含まれなくなりました（互換性のために空のプレースホルダーは維持）
   - Web可視化ではCO2データは表示されません

2. **P2-P6センサーノード**：
   - CO2センサーの初期化は無効化
   - CO2データの収集と送信は無効化

これらの変更により、システムはBME680センサーのみで適切に動作し、元のコード構造との互換性を維持しています。

## サポート

システムに関する技術的なサポートや質問については、システム管理者に連絡するか、システムに付属のドキュメントを参照してください。

---

*このドキュメントは、Raspberry Pi 5とPico 2Wスタンドアロン環境データ測定システムのドキュメントセット、バージョン2.0の一部です。*