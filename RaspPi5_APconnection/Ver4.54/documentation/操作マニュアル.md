# Raspberry Pi 5 環境データ測定システム Ver4.5 操作マニュアル

## 概要

このマニュアルでは、Raspberry Pi 5 (P1) を中心とした環境データ測定システムの操作方法について説明します。このシステムは、Raspberry Pi Pico 2W デバイス (P2, P3) からの環境データを収集し、可視化するためのものです。

Ver4.5では、以下の新機能が追加されました：

- リアルタイムセンサー値の表示
- グラフ保存機能
- 拡張された時間範囲選択（1日、3日、1週間、3ヶ月、6ヶ月、1年、すべて）
- 30秒ごとのグラフ自動更新
- 10秒ごとの接続状態更新
- グラフ更新のキャンセル機能
- 更新中の進行状況表示

## システムの起動

システムを起動するには、以下のコマンドを実行します：

```bash
sudo ~/envmonitor-venv/bin/python3 start_p1_solo45.py
```

このコマンドは、以下のサービスを起動します：

1. アクセスポイントのセットアップ
2. データ収集サービス (P2とP3の両方に対応)
3. Webインターフェース
4. 接続モニター

## Webインターフェースへのアクセス

システムが起動したら、以下のURLでWebインターフェースにアクセスできます：

```
http://192.168.0.1
```

このURLは、P1のアクセスポイントに接続されたデバイス（スマートフォン、タブレット、PC等）から利用できます。

## Webインターフェースの使用方法

### リアルタイムセンサー値

画面上部に、P2とP3からのリアルタイムセンサー値が表示されます。これには以下の情報が含まれます：

- 気温 (°C)
- 相対湿度 (%)
- 絶対湿度 (g/m³)
- CO2濃度 (ppm)
- 気圧 (hPa)
- ガス抵抗 (Ω)

これらの値は10秒ごとに自動更新されます。

### コントロールパネル

コントロールパネルでは、以下の設定が可能です：

#### データ表示の設定

- **P2データを表示**: P2からのデータをグラフに表示するかどうかを切り替えます。
- **P3データを表示**: P3からのデータをグラフに表示するかどうかを切り替えます。

#### 期間の選択

以下の期間からデータを表示する範囲を選択できます：

- 1日（デフォルト）
- 3日
- 1週間
- 3ヶ月
- 6ヶ月
- 1年
- すべて

#### 自動更新の設定

グラフの自動更新間隔を以下から選択できます：

- オフ
- 30秒（デフォルト）
- 1分
- 5分

#### その他の操作

- **今すぐ更新**: グラフを手動で更新します。
- **キャンセル**: 更新処理をキャンセルします（更新中のみ表示）。
- **データエクスポート**: 選択した期間のデータをCSVファイルとしてエクスポートします。
- **グラフ保存**: 現在表示されているグラフをHTML形式で保存します。

### グラフ表示

以下のパラメータのグラフが表示されます：

- 気温 (°C)
- 相対湿度 (%)
- 絶対湿度 (g/m³)
- CO2濃度 (ppm)
- 気圧 (hPa)
- ガス抵抗 (Ω)

各グラフでは、P2のデータは青色、P3のデータは赤色で表示されます。

### 接続状態

画面下部には、P2とP3の接続状態が表示されます。これには以下の情報が含まれます：

- 状態（オンライン/オフライン）
- 信号強度 (dBm)
- Ping時間 (ms)
- ノイズレベル (dBm)
- SNR (dB)
- 最終更新時刻

この情報は10秒ごとに自動更新されます。

## データのエクスポート

データをエクスポートするには、以下の手順に従います：

1. コントロールパネルの「データエクスポート」ボタンをクリックします。
2. 表示されるダイアログで、以下の設定を行います：
   - **デバイス**: エクスポートするデータのデバイスを選択します（P2、P3、またはすべて）。
   - **開始日**: エクスポートするデータの開始日を選択します。
   - **終了日**: エクスポートするデータの終了日を選択します。
3. 「エクスポート」ボタンをクリックします。
4. CSVファイルがダウンロードされます。

## グラフの保存

グラフを保存するには、以下の手順に従います：

1. コントロールパネルの「グラフ保存」ボタンをクリックします。
2. 表示されるダイアログで、以下の設定を行います：
   - **ファイル名**: 保存するファイルの名前を入力します。
   - **保存するグラフ**: 保存するグラフを選択します（気温、相対湿度、絶対湿度、CO2濃度、気圧、ガス抵抗、ダッシュボード）。
3. 「保存」ボタンをクリックします。
4. 選択したグラフがZIPファイルとしてダウンロードされます。ZIPファイルには、選択したグラフのHTML形式のファイルが含まれています。

## トラブルシューティング

### グラフが表示されない場合

以下を確認してください：

1. P2またはP3が正常に動作しているか（接続状態を確認）
2. データ収集サービスが正常に動作しているか（システム起動時のログを確認）
3. 選択した期間内にデータが存在するか（期間を「すべて」に変更して確認）

### 接続状態が「オフライン」と表示される場合

以下を確認してください：

1. P2またはP3の電源が入っているか
2. P2またはP3がP1のアクセスポイントに接続されているか
3. P2またはP3のWiFi設定が正しいか

### 自動更新が機能しない場合

以下を確認してください：

1. 自動更新の設定が「オフ」になっていないか
2. ブラウザのタブがアクティブになっているか（多くのブラウザは、非アクティブなタブでのタイマー処理を遅延させます）

### グラフの更新に時間がかかる場合

データ量が多い場合、特に「すべて」の期間を選択している場合は、グラフの更新に時間がかかることがあります。更新中に「キャンセル」ボタンをクリックすると、更新処理をキャンセルできます。

## 注意事項

- システムを長時間使用する場合は、P1、P2、P3の電源が安定していることを確認してください。
- データは定期的にバックアップすることをお勧めします。
- P1のストレージ容量には限りがあるため、長期間のデータを保存する場合は、定期的にデータをエクスポートしてください。