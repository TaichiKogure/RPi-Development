# Ver4.32 デバッグ - 固定ファイル名の実装

## 変更内容

### 問題点
以前の実装では、センサーデータを日付ベースのファイル名（例：「P2_2023-05-15.csv」）で保存していました。このアプローチにはいくつかの欠点がありました：
- 日付ベースのファイルが見つからない場合、グラフが描画できない
- 特定の日付範囲のデータを見つけるために複数のファイルを検索する必要があった
- ファイル処理がより複雑でエラーが発生しやすかった

### 解決策
センサーデータを日付ベースのファイルと固定ファイルの両方に保存する固定ファイル名アプローチを実装しました：
- 日付ベースのファイル：`/var/lib/raspap_solo/data/RawData_P2/P2_YYYY-MM-DD.csv`
- 固定ファイル：`/var/lib/raspap_solo/data/RawData_P2/P2_fixed.csv`

システムは固定ファイルからの読み取りを優先し、必要な場合のみ日付ベースのファイルにフォールバックするようになりました。固定ファイルは時間の経過とともに日付ベースのファイルからデータを連結して作成され、連続的な履歴記録を提供します。

### 利点
- デバイスごとに単一の固定ファイルによるシンプルなデータアクセス
- より信頼性の高いグラフ描画
- 数値形式と文字列形式の両方のタイムスタンプを自動的に処理
- 既存の日付ベースのファイルとの後方互換性

## 技術的詳細

### データ収集の変更点
1. `_init_csv_files()`を修正して、日付ベースと固定の両方のCSVファイルを初期化するようにしました
2. `_rotate_csv_files()`を修正して、固定ファイルを処理するようにしました
3. `_store_data()`を修正して、データを日付ベースと固定の両方のCSVファイルに書き込むようにしました
4. `stop()`を修正して、両方のタイプのファイルを閉じるようにしました

### データ読み取りの変更点
1. `get_historical_data()`を修正して、固定ファイルからの読み取りを優先するようにしました
2. 固定ファイルが存在しないか読み取れない場合に日付ベースのファイルにフォールバックする機能を追加しました
3. より良い診断のためにエラー処理とロギングを改善しました

## 使用方法
システムの使用方法に変更は必要ありません。改善点は透過的に機能します：
- 固定ファイルが存在する場合、自動的に使用されます
- 固定ファイルが存在しない場合、システムは日付ベースのファイルにフォールバックします
- すべての新しいデータは日付ベースと固定の両方のファイルに書き込まれます

## 実装に関する注意点
- 固定ファイルは、存在しない場合に作成され、時間の経過とともにデータが追加されます
- 新しい日付ベースのファイルが作成されると、そのデータは既存の固定ファイルに追加されます
- 両方のタイプのファイルは同じCSV形式と同じヘッダーを使用します
- タイムスタンプ処理は数値形式と文字列形式の両方を自動的に検出して変換します
