# プロジェクト構造ドキュメント

## 概要

このドキュメントは、Raspberry Pi 5 AP Connection システム（バージョン4.60）のプロジェクト構造の概要を提供します。プロジェクトはいくつかのコンポーネントに分かれており、それぞれがシステム全体で特定の責任を持っています。

## 主要コンポーネント

プロジェクトは3つの主要コンポーネントに分かれています：

1. **p1_software_solo405**: Raspberry Pi 5（P1）用のソフトウェアで、中央ハブとして機能します
2. **P2_software_debug**: Raspberry Pi Pico 2W（P2）用のソフトウェアで、センサーノードとして機能します
3. **P3_software_debug**: Raspberry Pi Pico 2W（P3）用のソフトウェアで、もう一つのセンサーノードとして機能します

## P1ソフトウェア構造

P1ソフトウェアはいくつかのモジュールに分かれており、それぞれが特定の責任を持っています：

### 1. ap_setup

このモジュールはRaspberry Pi 5をWiFiアクセスポイントとして設定する責任があります。以下を含みます：

- **P1_ap_setup_solo.py**: アクセスポイントの設定と管理のためのメインスクリプト

### 2. connection_monitor

このモジュールはP1とセンサーノード（P2とP3）間のWiFi接続を監視します。以下のように構成されています：

- **P1_wifi_monitor_solo.py**: 接続モニターのメインエントリーポイント
- **config.py**: 接続モニターの設定
- **main.py**: 接続モニターのメイン機能
- **monitor.py**: コア監視機能
- **__init__.py**: パッケージ初期化ファイル

サブモジュール：
- **api/**: 接続監視データにアクセスするためのAPI
  - **__init__.py**: パッケージ初期化ファイル
  - **routes.py**: APIルート定義
  - **server.py**: APIサーバー実装
- **measurements/**: 接続品質を測定するための機能
  - **ping.py**: Ping測定の実装
  - **signal_strength.py**: 信号強度測定の実装
- **utils/**: ユーティリティ関数
  - **__init__.py**: パッケージ初期化ファイル
  - **console.py**: コンソール出力ユーティリティ

### 3. data_collection

このモジュールはセンサーノード（P2とP3）からデータを収集します。以下を含みます：

- **P1_data_collector_solo.py**: センサーデータの収集と保存のためのメインスクリプト

### 4. web_interface

このモジュールは収集したデータを可視化するためのウェブインターフェースを提供します。以下を含みます：

- **P1_app_solo.py**: ウェブインターフェースのメインスクリプト

### 5. ルートレベル

- **start_p1_solo.py**: すべてのP1サービスを開始するためのメインスクリプト

## P2およびP3ソフトウェア構造

P2とP3のソフトウェアは、どちらもセンサーノードとして機能するため、類似した構造を持っています。以下を含みます：

- **センサードライバー**: 接続されたセンサーからデータを読み取るため
- **データ送信**: P1にデータを送信するため
- **エラー処理**: エラーを処理し、必要に応じて自動再起動するため

## モジュール依存関係

モジュール間の主な依存関係は以下の通りです：

1. **start_p1_solo.py**はすべてのサービスを開始するため、他のすべてのP1モジュールに依存しています
2. **connection_monitor**は**ap_setup**によって提供されるWiFi設定に依存しています
3. **data_collection**は**ap_setup**によって提供されるWiFi設定に依存しています
4. **web_interface**は**data_collection**によって収集されたデータと**connection_monitor**からの接続状態に依存しています

## インポート構造

プロジェクトでは、絶対インポートと相対インポートの組み合わせを使用しています：

- 絶対インポートは現在のパッケージ外からインポートする場合に使用されます
- 相対インポートは同じパッケージ内からインポートする場合に使用されます

例えば、connection_monitorモジュールでは：

```python
# 絶対インポート（パッケージ外から）
import os
import sys
import time

# 相対インポート（パッケージ内から）
from connection_monitor.config import DEFAULT_CONFIG
from connection_monitor.monitor import WiFiMonitor
```

## ベストプラクティス

このプロジェクト構造で作業する際は：

1. **パッケージの整合性を維持する**: 各モジュールに`__init__.py`ファイルがあることを確認してください
2. **適切なインポートを使用する**: 特にモジュール間でインポートする場合は、明確さのために絶対インポートを使用してください
3. **モジュールの境界に従う**: 機能を適切なモジュール内に保ってください
4. **ドキュメントを更新する**: 構造を変更する場合は、このドキュメントを更新してください