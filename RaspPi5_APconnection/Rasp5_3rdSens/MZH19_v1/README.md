# MH-Z19 CO2 Sensor Data Logger for Raspberry Pi 5

このプログラムは、ラズベリーパイ5に接続されたMH-Z19 CO2センサーからデータを読み取り、10秒ごとにCSVファイルに出力します。また、起動時に適切に初期化し、終了時にはポートを正しく解放します。

## 機能

- MH-Z19 CO2センサーの初期化と設定
- 10秒ごとのCO2濃度データの読み取り
- タイムスタンプ付きでCSVファイルにデータを記録
- 適切なエラー処理とリトライ機能
- プログラム終了時のクリーンアップ処理（ポート解放）
- シグナルハンドリング（Ctrl+Cでの安全な終了）

## 必要条件

- Raspberry Pi 5
- Python 3.6以上
- pyserial ライブラリ
- MH-Z19 CO2センサー

## インストール方法

1. 必要なライブラリをインストールします：

```bash
pip3 install pyserial
```

2. MH-Z19センサーをRaspberry Pi 5に接続します：

- VCC（赤）→ 5V
- GND（黒）→ GND
- TX（緑）→ GPIO 14（UART0 RX）
- RX（青）→ GPIO 15（UART0 TX）

3. Raspberry Pi 5のUARTを有効にします：

```bash
sudo raspi-config
```

- 「Interface Options」を選択
- 「Serial Port」を選択
- シリアルログインシェルを無効にする
- シリアルハードウェアを有効にする

## 使用方法

基本的な使い方：

```bash
python3 MZH19_test.py
```

出力ファイルを指定する場合：

```bash
python3 MZH19_test.py /path/to/output.csv
```

プログラムを終了するには、`Ctrl+C`を押します。

## 出力形式

CSVファイルは以下の形式で出力されます：

```
Timestamp,CO2 (ppm)
2023-07-01 12:34:56,450
2023-07-01 12:35:06,455
...
```

## トラブルシューティング

1. **センサーが応答しない場合**：
   - 配線が正しく接続されているか確認してください
   - UARTが有効になっているか確認してください
   - 別のUARTデバイスパスを試してみてください（例：`/dev/ttyS0`）

2. **異常な値が出力される場合**：
   - センサーのウォームアップ時間（30秒）を待ってください
   - センサーを再起動してみてください

3. **パーミッションエラーが発生する場合**：
   - 以下のコマンドを実行してシリアルポートへのアクセス権を付与してください：
   ```bash
   sudo usermod -a -G dialout $USER
   ```
   - その後、ログアウトして再度ログインしてください

## ライセンス

MITライセンス