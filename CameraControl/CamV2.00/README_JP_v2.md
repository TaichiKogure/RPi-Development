# Cam2M ver2.0 — 自動静止画撮影 & タイムラプス対応 GUI

本バージョンは、従来の Cam2M_v1.3.py（推論表示）を変更せず、別ファイル Cam2M_v2.0.py として以下の機能を追加したものです。

- GUI（Tkinter）で設定変更
  - デバイス番号、解像度（幅×高さ）、FPS
  - 自動静止画撮影の間隔（秒）
  - 出力フォルダの選択
  - タイムラプス動画のフレームレート（FPS）
- ライブプレビュー表示（OpenCV + Pillow）
- 任意の間隔で自動静止画（JPEG）を保存（ファイル名にタイムスタンプ付与）
- 保存した静止画をつないで MP4 のタイムラプス動画を生成
- 生成したタイムラプス動画の簡易再生（OpenCV ウィンドウ、q/Esc で停止）

注意：本 v2 は TensorFlow に依存しません。物体検出などは含まず、カメラ制御・保存・タイムラプスに特化しています。

---

## 動作環境 / 事前準備

- Windows（Web カメラ）で動作確認済み
- Python 3.9+ 推奨
- 必要な Python パッケージ
  - opencv-python
  - pillow

インストール例:

```
pip install opencv-python pillow
```

※ MP4 出力のため VideoWriter の FourCC に `mp4v` を使用しています。PC によっては必要コーデックが不足する場合があります。その際は別の FourCC（例: `XVID`）や AVI 出力への変更をご検討ください。

---

## ファイル構成

```
CameraControl\
└─ CamV2.00\
   ├─ Cam2M_v2.0.py   # 本体（GUI）
   └─ README_JP_v2.md # このファイル
```

初回起動時、キャプチャ画像の保存先として `Captured` フォルダ（実行ディレクトリ直下）が自動作成されます。

---

## 使い方（基本）

1. 実行
   ```
   python CameraControl\CamV2.00\Cam2M_v2.0.py
   ```

2. GUI 画面が開きます。上部コントロールで以下を設定可能です。
   - Device（デバイス番号）: 通常 0。複数カメラがある場合は 1, 2… を試してください。
   - Resolution（WxH）: 例 1280×720。ドライバにより希望値にならないことがあります。
   - FPS: プレビューの目安。環境によっては実測 FPS と一致しない場合があります。
   - Capture Interval (sec): 自動静止画保存の間隔（秒）。
   - Output Folder: 保存先フォルダ。Browse で変更できます。
   - Timelapse FPS: タイムラプス動画のフレームレート。

3. ライブプレビュー
   - 「Start Preview」でカメラを起動し、プレビューが表示されます。
   - 「Stop Preview」で停止します（カメラ解放）。

4. 自動静止画撮影
   - 「Start Auto Capture」で指定間隔ごとに JPEG を保存します。
   - ステータス欄に保存ファイル名が表示されます。
   - 「Stop Auto Capture」で停止します。

5. タイムラプス生成
   - 「Create Timelapse」で出力フォルダ内の画像（拡張子 jpg/jpeg/png）をファイル名順に連結し、MP4 を作成します。
   - 進捗バーが表示され、完了すると保存先が表示されます。

6. タイムラプス再生
   - 「Play Timelapse」で直近に生成した MP4 を再生します。
   - 未生成の場合はファイル選択ダイアログが表示されます。
   - 再生ウィンドウで `q` または `Esc` で終了します。

---

## よくある質問 / トラブルシュート

- 「カメラが開けない」
  - Device 番号が誤っている場合があります。0/1/2… を切り替えてお試しください。
  - 別アプリがカメラを占有している可能性があります。該当アプリを終了してください。

- 「設定した解像度や FPS にならない」
  - カメラやドライバの制約により指定通りに設定できないことがあります。一般的な解像度（1280×720, 1920×1080 など）をお試しください。

- 「タイムラプスの生成に失敗する」
  - 出力フォルダに画像がない、もしくは破損した画像が含まれている可能性があります。
  - MP4 コーデックの問題の可能性もあります。別の FourCC（例: XVID）での出力に変更して再試行してください（コード内 `VideoWriter_fourcc` 部分）。

- 「プレビューが表示されない」
  - Pillow が未インストールの場合、プレビューが機能しません。`pip install pillow` を実行してください。

---

## 既存 v1.3 との関係

- v1.3（Cam2M_v1.3.py）は TensorFlow を用いた物体検出のデモです。本 v2 は GUI によるカメラ制御・自動静止画保存・タイムラプス生成に特化しており、推論処理は行いません。
- v1.3 は変更せずそのまま残してあります。必要に応じて併用ください。

---

## カスタマイズのヒント

- 画像保存の画質（JPEG 品質）は 95 に設定しています。`cv2.imwrite` の引数で変更可能です。
- タイムラプス出力サイズを固定したい場合は、`create_timelapse(size_hint=(width, height))` を渡すなどの拡張が可能です。
- 出力ファイル命名規則や拡張子のフィルタリングは `TimelapseCreator._find_images()` を編集してください。

---

## ライセンス

本サンプルは社内検証用サンプルとして提供します。外部配布時は各依存ライブラリ（OpenCV, Pillow）のライセンスに従ってください。
