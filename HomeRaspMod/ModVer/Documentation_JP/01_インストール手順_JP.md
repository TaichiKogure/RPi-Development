# Flask10X インストール手順（日本語）

最終更新日: 2025-08-24
対象バージョン: Flask10X Steps 1–9 実装版

本書は、Flask10X を Raspberry Pi（Linux）上で導入する標準手順です。Windows 上での動作確認も可能ですが、本番運用は Linux（Raspberry Pi OS 等）を推奨します。

---

## 1. 事前要件

- Python 3.9 以上（推奨）
- pip と venv が利用可能であること
- ネットワーク接続（内部/外部）
- （本番）systemd が利用可能な環境

---

## 2. 仮想環境のセットアップ（推奨）

```bash
# ホームディレクトリで作成（名称は任意）
cd ~
python3 -m venv envmonitor-venv
source envmonitor-venv/bin/activate

# 依存パッケージをインストール
pip install --upgrade pip
pip install flask gunicorn
```

備考: ログ/CSV の出力先はリポジトリ直下（HomeRaspMod/ModVer）既定ですが、必要に応じて権限を確認してください。

---

## 3. リポジトリ配置

このドキュメントは以下のパス構造を前提としています。

```
/home/pi/RaspPi5_APconnection/HomeRaspMod/ModVer
```

別パスの場合は、後述の systemd ユニット（flask10x.service）や説明中のパスを読み替えてください。

---

## 4. 開発モードでの起動（簡易）

```bash
cd /home/pi/RPi_Development01/HomeRaspMod/ModVer
source ~/envmonitor-venv/bin/activate
python3 BackUPFlask10X.py
```

- 既定ポート: 8888
- 確認: `curl -s http://localhost:8888/healthz`

停止は Ctrl+C で可能です。

---

## 5. 本番モード（Gunicorn + systemd）

### 5.1 依存の確認

```bash
source ~/envmonitor-venv/bin/activate
pip install gunicorn
```

### 5.2 systemd ユニットを配置

```bash
sudo cp /home/pi/RPi_Development01/HomeRaspMod/ModVer/BackUPflask10x.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable flask10x
sudo systemctl start flask10x
```

### 5.3 操作コマンド

- 起動: `sudo systemctl start flask10x`
- 停止: `sudo systemctl stop flask10x`
- 再起動: `sudo systemctl restart flask10x`
- 状態: `systemctl status flask10x`

### 5.4 稼働確認

- ヘルスチェック: `curl -s http://localhost:8888/healthz`
- メトリクス: `curl -s http://localhost:8888/metrics | jq`

---

## 6. ファイル権限とパスの注意

- `HomeRaspMod/ModVer/logs` および CSV 出力先（PicodataX.csv など）に対し、実行ユーザ（例: pi）が読み書き可能であること
- 本番では、flask10x.service 内の `User`, `Group`, `WorkingDirectory`, `ExecStart`, `Environment` を環境に合わせて修正
- ポート 8888 がファイアウォールで許可されているか確認

---

## 7. 依存関係の変更

追加のライブラリを使用する場合は、仮想環境内で `pip install` を実行し、必要に応じて requirements.txt を管理してください。

---

## 8. アンインストール/クリーンアップ

- systemd 無効化: `sudo systemctl disable --now flask10x`
- ログ/CSV の削除は任意で行ってください（重要データが含まれる可能性に注意）。

---

## 9. よくある準備ミス

- 仮想環境を有効化し忘れてモジュールが見つからない
- `WorkingDirectory` が誤っていて Gunicorn が Flask10X:app を解決できない
- ログ/CSV 出力先に書き込み権限がない

---

以上でインストールは完了です。起動と運用については「02_起動と運用_JP.md」を参照してください。