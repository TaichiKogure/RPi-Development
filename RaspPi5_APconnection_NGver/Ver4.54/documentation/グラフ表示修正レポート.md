# グラフ表示修正レポート

## 概要

環境データ可視化システムのグラフ表示機能を改善するため、CSVファイルを直接読み込んで表示するUIを実装しました。この修正により、以下の機能が追加されました：

1. コマンドラインからCSVファイルを指定して環境データのグラフを表示できる機能
2. 表示する日数を指定する機能
3. P2とP3のデータ表示を個別に切り替える機能
4. グラフをHTMLファイルとして保存する機能

既存のWebインターフェースのセンサーノードのリアルタイム表示やシグナル強度情報の機能は変更せず、グラフ表示部分のみを修正しています。

## 新機能: graph_viewer.py

新しく追加された`graph_viewer.py`は、コマンドラインから環境データのグラフを表示するためのツールです。

### 主な機能

- P2とP3のCSVデータファイルからデータを読み込み
- 指定した日数分のデータをフィルタリング
- 各パラメータ（気温、湿度、絶対湿度、CO2濃度、気圧、ガス抵抗）の個別グラフ生成
- すべてのパラメータを含むダッシュボードの生成
- グラフをHTMLファイルとして保存またはブラウザで表示
- P2とP3のデータ表示を個別に切り替え

### 使用方法

```bash
python graph_viewer2.py [オプション]
```

#### オプション

- `--p2-path PATH`: P2のCSVデータファイルのパス（デフォルト: /var/lib/raspap_solo/data/RawData_P2/P2_fixed.csv）
- `--p3-path PATH`: P3のCSVデータファイルのパス（デフォルト: /var/lib/raspap_solo/data/RawData_P3/P3_fixed.csv）
- `--days DAYS`: 表示するデータの日数（デフォルト: 1）
- `--show-p2`: P2のデータを表示（デフォルト: True）
- `--show-p3`: P3のデータを表示（デフォルト: True）
- `--output PATH`: 出力ファイルのパス（デフォルト: None、ブラウザで表示）

### 使用例

#### ブラウザでグラフを表示

```bash
python graph_viewer2.py
```

#### 過去7日間のデータを表示

```bash
python graph_viewer2.py --days 7
```

#### P2のデータのみを表示

```bash
python graph_viewer2.py --show-p2 --show-p3 False
```

#### グラフをHTMLファイルとして保存

```bash
python graph_viewer2.py --output /path/to/output/graphs
```

## 技術的詳細

### データ処理

- CSVファイルから読み込んだデータのタイムスタンプを適切な日時形式に変換
- 数値データを適切な型に変換
- 指定した日数分のデータをフィルタリング
- 無効なデータを除外

### グラフ生成

- 各パラメータに適したY軸の範囲を自動計算
- パラメータに応じて適切なY軸の最小値を設定（例：CO2濃度は常に0以上）
- 複数のデータセット（P2とP3）を同じグラフに表示
- 日本語のラベルとタイトルを使用

### ダッシュボード

- 3x2のグリッドレイアウトで6つのパラメータを表示
- 各グラフに適切なY軸の範囲を設定
- 凡例を表示してP2とP3のデータを区別

## 既存のWebインターフェースとの関係

新しい`graph_viewer.py`は、既存のWebインターフェース（`P1_app_simple45.py`）と並行して使用できます。Webインターフェースはブラウザベースのインタラクティブな環境を提供し、リアルタイムデータの表示やデータのエクスポートなどの機能を持っています。一方、`graph_viewer.py`はコマンドラインからの簡単なグラフ表示と保存に特化しています。

両方のツールは同じCSVデータファイルを読み込むため、データの整合性は保たれます。

## 今後の改善点

1. より多くのグラフオプション（線の色、マーカーのスタイルなど）を追加
2. データの統計分析機能の追加
3. 複数のCSVファイルの結合と表示
4. 異常値の検出と強調表示
5. グラフの自動更新機能