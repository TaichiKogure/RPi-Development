# Raspberry Pi 5 と Pico 2W による環境データ測定システム Ver4.44

## システム概要

このシステムは、Raspberry Pi 5（P1）を中心ハブとし、2台のRaspberry Pi Pico 2W（P2、P3）をセンサーノードとして使用する環境データ測定システムです。システムは温度、湿度、気圧、ガスパラメータ、CO2濃度などの環境データを収集し、可視化して分析のために保存します。

### システムコンポーネント

1. **Raspberry Pi 5（P1）** - 中心ハブとして以下の機能を提供:
   - P2とP3のためのWiFiアクセスポイントとして機能
   - センサーノードからの環境データを収集・保存
   - データ可視化のためのWebインターフェースを提供
   - センサーノードとの接続品質を監視

2. **Raspberry Pi Pico 2W（P2、P3）** - センサーノードとして以下の機能を提供:
   - BME680センサーを使用して環境データを収集
   - MH-Z19Bセンサーを使用してCO2レベルを測定
   - WiFi経由でデータをP1に送信
   - エラーや接続問題が発生した場合に自動再起動

3. **センサー**:
   - BME680 - 温度、湿度、気圧、ガスパラメータを測定
   - MH-Z19B - CO2濃度を測定

### システム構成

システムはRaspPi5_APconnectionディレクトリ内に構成され、以下を含みます:

```
RaspPi5_APconnection\Ver4.44\
├── p1_software_solo44\              # Raspberry Pi 5用ソフトウェア
│   ├── ap_setup\                    # アクセスポイント設定
│   │   └── P1_ap_setup_solo44.py    # APセットアップスクリプト
│   ├── data_collection\             # P2とP3からのデータ収集
│   │   └── P1_data_collector_solo44.py # データ収集スクリプト
│   ├── web_interface\               # データ可視化用WebUI
│   │   └── P1_app_simple44.py       # Webアプリケーション
│   ├── connection_monitor\          # WiFi信号監視
│   │   └── P1_wifi_monitor_solo44.py # 接続モニタリングスクリプト
│   └── start_p1_solo44.py           # 統合起動スクリプト
└── documentation\                   # ユーザーマニュアルとガイド
    ├── システム概要.md               # システム概要（本ドキュメント）
    ├── インストールガイド.md         # インストール手順
    ├── 操作マニュアル.md             # 操作手順
    └── トラブルシューティング.md     # 問題解決ガイド
```

### 主な機能

#### P1（Raspberry Pi 5）の機能
- **デュアルWiFi機能**:
  - P2とP3のためのWiFiアクセスポイント（AP）として機能
  - USB WiFiドングル経由でインターネットに接続可能
  - USB ドングルがない場合はAPモードを優先するよう設定可能

- **データ管理**:
  - P2とP3から環境データを受信・保存
  - タイムスタンプ、温度、湿度、気圧、ガスパラメータ、CO2レベルをCSV形式で保存
  - 温度と湿度から絶対湿度を計算

- **可視化**:
  - P1のWiFiに接続したスマートフォン/デバイスからアクセス可能なWebUI
  - 環境データの時系列グラフ
  - 現在の測定値のリアルタイム表示
  - データのCSVエクスポート機能

- **接続監視**:
  - P2とP3とのWiFi信号強度、ping時間、ノイズレベルを測定
  - 5秒ごと（設定可能）に更新
  - デバイスの物理的な配置の最適化に役立つ
  - WebUIとVNCインターフェースの両方で利用可能

#### P2、P3（Raspberry Pi Pico 2W）の機能
- **センサー統合**:
  - 30秒ごとのBME680センサー読み取り
  - 30秒ごとのMH-Z19B CO2読み取り

- **データ送信**:
  - WiFi経由でP1への継続的なデータ送信
  - P2とP3デバイスの一意の識別

- **信頼性**:
  - センサーエラーやデータ収集の失敗時に自動再起動
  - 再起動後のWiFi自動再接続

### 統合起動システム

Ver4.44では、`start_p1_solo44.py`スクリプトを使用して、P1上のすべてのサービスを一度に起動できます。このスクリプトは以下を実行します:

1. アクセスポイントのセットアップと有効化
2. データ収集サービスの起動
3. Webインターフェースの起動
4. 接続モニターの起動
5. すべてのサービスの状態監視と必要に応じた再起動

このスクリプトはコマンドラインから以下のように実行します:

```
sudo ~/envmonitor-venv/bin/python3 start_p1_solo44.py
```

### バージョン情報

すべてのソフトウェアコンポーネントとドキュメントには、適切な追跡と互換性管理のためのバージョン番号が含まれています。Ver4.44では、すべてのファイル名に「44」サフィックスが追加され、他のバージョンと区別できるようになっています。