# BME680環境データモニター（システムモニタリング機能付き）

## 概要

このプロジェクトは、Raspberry Pi Pico、BME680センサー、SSD1306 OLEDディスプレイを使用した環境データ監視システムを実装しています。システムは温度、湿度、気圧、ガス抵抗を測定し、稼働時間、CPU使用率、メモリ使用率などのシステム情報とともにOLEDスクリーンに表示します。

このシステムは、スタンドアロンで耐障害性のあるシステムとして設計されており、自動復旧メカニズムと包括的なエラー処理を備えています。

## 特徴

- **スタンドアロン動作**: システムはboot.pyを必要とせず、main.pyから直接実行されます
- **システムモニタリング**: 稼働時間、CPU使用率、メモリ使用率を表示します
- **ウォッチドッグタイマー**: システムがハングしたり応答しなくなった場合に自動的にリセットします
- **エラーログ**: エラーと再起動をログファイルに記録してトラブルシューティングを支援します
- **堅牢なエラー処理**: センサーエラーやその他の障害を適切に処理します
- **視覚的フィードバック**: オンボードLEDを使用してシステムステータスとエラーを表示します
- **データ可視化**: 環境データをOLEDスクリーンに簡単なアニメーションとともに表示します

## ハードウェア要件

- Raspberry Pi PicoまたはPico W
- BME680環境センサー
- SSD1306 OLEDディスプレイ（128x64ピクセル、SPIインターフェース）
- ジャンパーワイヤー

## ハードウェア接続

### BME680センサー（I2C接続）
- VCC → 3.3V（ピン36）
- GND → GND（ピン38）
- SCL → GP1（ピン2）
- SDA → GP0（ピン1）

### SSD1306 OLEDディスプレイ（SPI接続）
- VCC → 3.3V（ピン36）
- GND → GND（ピン38）
- DIN（MOSI）→ GP3（ピン5）
- CLK（SCK）→ GP2（ピン4）
- CS → GP6（ピン9）
- DC → GP4（ピン6）
- RST → GP5（ピン7）

## ソフトウェアセットアップ

1. 以下のファイルをRaspberry Pi Picoにコピーします：
   - `main.py` - 起動時に自動的に実行されるメインプログラム
   - `bme680.py` - BME680センサードライバー
   - `ssd1306.py` - SSD1306 OLEDディスプレイドライバー

2. Picoの電源を入れてシステムを起動します

## 表示情報

OLEDディスプレイには以下の情報が表示されます：

1. **稼働時間**: システムが稼働している時間（形式：X日 X時間 X分 X秒）
2. **CPU/メモリ使用率**: 現在のCPUとメモリの使用率をパーセンテージで表示（形式：XX％/YY％）- ラベルなしで表示し、視認性を向上
3. **温度**: 現在の温度（摂氏）
4. **相対湿度**: 現在の湿度（パーセンテージ）
5. **絶対湿度**: 計算された絶対湿度（g/m³）
6. **気圧**: 現在の大気圧（hPa）
7. **ガス抵抗**: 現在のガス抵抗（オーム、大きな値にはkまたはM接尾辞）

画面の右側には、バウンシングボックスのアニメーションが表示されます。

## 復旧メカニズム

システムはいくつかのエラー回復メカニズムを実装しています：

1. **ウォッチドッグタイマー**: システムがハングしたり応答しなくなった場合に自動的にリセットします
2. **センサーエラー処理**: BME680センサーが無効な読み取り値を返した場合、システムは最後の有効な読み取り値を使用します
3. **初期化エラー処理**: 初期化に失敗した場合、システムは再起動を試みます
4. **実行時エラー処理**: 操作中にエラーが発生した場合、システムはエラーをログに記録して続行します
5. **重大なエラー処理**: 重大なエラーが発生した場合、システムは強制的にリセットします

## 視覚的フィードバック

オンボードLEDはシステムステータスに関する視覚的フィードバックを提供します：

1. **起動時**: システム起動時に3回の短い点滅
2. **エラー**: エラー発生時の急速な点滅（10回）
3. **再起動**: システム再起動時に5回の短い点滅
4. **測定**: センサー測定中にLEDが点灯

## トラブルシューティング

### システムが起動しない場合

システムが起動しない場合：

1. 電源接続を確認します
2. 必要なファイルがすべてPicoにあることを確認します
3. USB経由でPicoに接続してエラーログを確認します

### センサーエラー

センサーの読み取り値が正しくないか欠落している場合：

1. センサー接続を確認します
2. センサーアドレス（0x76または0x77）を確認します
3. センサー固有のエラーについてエラーログを確認します

### ディスプレイの問題

ディスプレイが動作しない場合：

1. ディスプレイ接続を確認します
2. SPIピン割り当てを確認します
3. ディスプレイ固有のエラーについてエラーログを確認します

## 高度な使用法

### ウォッチドッグタイムアウトの変更

ウォッチドッグタイムアウトは、`init_watchdog`関数呼び出しのパラメータを変更することで調整できます：

```python
# ウォッチドッグタイマーを初期化（8秒タイムアウト）
init_watchdog(8000)
```

### ログへのアクセス

エラーログにアクセスするには：

1. PicoをUSB経由でコンピュータに接続します
2. ThonnyまたはほかのMicroPython IDEを開きます
3. Picoのファイルシステムから`error_log.txt`ファイルを開きます

## バージョン履歴

- **2.0** - システムモニタリング機能（稼働時間、CPU、メモリ）を追加したスタンドアロンバージョン
- **1.5** - 自動起動と復旧機能を追加
- **1.4** - 複数のバウンシングボックスによるアニメーションの改良
- **1.3** - 絶対湿度計算を追加
- **1.2** - ディスプレイフォーマットの強化
- **1.1** - アニメーションを追加
- **1.0** - 初期リリース