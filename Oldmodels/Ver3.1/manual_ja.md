# ラズベリーパイ5とPico 2W 環境データ測定システム Ver3.1 マニュアル

## 概要
このマニュアルは、ラズベリーパイ5（P1）とラズベリーパイPico 2W（P2）を使用した環境データ測定システムのVer3.1における変更点と使用方法について説明します。

## 主な変更点

### P1（ラズベリーパイ5）の変更点
1. **起動プログラムの改善**
   - `start_p1_solo.py`に各サービスの稼働状態をコマンドプロンプト上に表示する機能を追加
   - 10秒ごとに全サービスのステータスを表示
   - 問題があるサービスを自動的に再起動する機能を強化

### P2（ラズベリーパイPico 2W）の変更点
1. **起動時の安定性向上**
   - WiFi接続前の待機時間を5秒から8秒に延長し、接続の安定性を向上
   - システム全体の初期化プロセスを改善

2. **LED表示機能の強化**
   - 異なる状態を明確に区別できるようLED点滅パターンを整理
   - 以下の状態を区別して表示:
     - WiFi接続中: 200ms間隔で点滅
     - WiFi未接続: 1000ms間隔で点滅
     - データ送信時: 短い点灯（200ms）
     - WiFiエラー: 2回連続点滅を繰り返す
     - センサーエラー: 3回連続点滅を繰り返す
     - 両方エラー: 4回連続点滅を繰り返す

3. **エラー処理の強化**
   - センサーエラーとWiFiエラーを個別に検出・管理
   - エラー状態をコンソールに明確に表示
   - エラー発生時も可能な限り動作を継続

## 使用方法

### P1（ラズベリーパイ5）の起動方法
1. ラズベリーパイ5の電源を入れ、ログインします
2. 仮想環境を有効化します:
   ```
   cd ~
   source envmonitor-venv/bin/activate
   ```
3. 統合起動スクリプトを実行します:
   ```
   cd /path/to/p1_software_solo31
   sudo ~/envmonitor-venv/bin/python3 start_p1_solo.py
   ```
4. コマンドプロンプト上に各サービスの状態が表示されます:
   ```
   ===== P1 Services Status =====
   data_collector: ✓ 正常稼働中 (PID: 1234)
   web_interface: ✓ 正常稼働中 (PID: 1235)
   connection_monitor: ✓ 正常稼働中 (PID: 1236)

   全サービスが正常に稼働しています。
   =============================
   ```

### P2（ラズベリーパイPico 2W）の使用方法
1. P2_main_solo.pyをPico 2Wに転送します
2. Pico 2Wの電源を入れると、自動的にプログラムが実行されます
3. LEDの点滅パターンで動作状態を確認できます:
   - 速い点滅（200ms間隔）: WiFi接続済み、正常動作中
   - 遅い点滅（1秒間隔）: WiFi接続試行中
   - 2回連続点滅: WiFiエラー
   - 3回連続点滅: センサーエラー
   - 4回連続点滅: 両方エラー
   - 短い点灯: データ送信時

## トラブルシューティング

### P1の問題
1. **サービスが起動しない場合**
   - 仮想環境が有効化されているか確認
   - 必要なパッケージがインストールされているか確認
   - ログファイル（/var/log/p1_startup_solo.log）を確認

2. **P2からデータが受信できない場合**
   - P1のアクセスポイントが正常に動作しているか確認
   - P2のIPアドレスとP1のIPアドレスが正しく設定されているか確認
   - ファイアウォール設定を確認

### P2の問題
1. **WiFi接続エラー**
   - P1のアクセスポイントが起動しているか確認
   - SSIDとパスワードが正しいか確認
   - P2を再起動して再接続を試みる

2. **センサーエラー**
   - センサーの接続を確認
   - I2Cアドレスが正しいか確認（0x77）
   - センサーの電源を確認

3. **両方のエラーが発生している場合**
   - P2を再起動
   - P1とP2の両方を再起動
   - センサーの接続を確認

## 注意事項
- P1は必ず仮想環境（envmonitor-venv）内で実行してください
- P2は起動時に8秒間の待機時間があります
- システムの安定動作のため、P1とP2の距離は近く保つことをお勧めします